<?php
/**
 * VÃ©rifier la structure de la table users
 */

echo "ðŸ” VÃ©rification de la structure de la table users\n";
echo "===============================================\n\n";

try {
    // Connexion Ã  la base de donnÃ©es
    $host = 'localhost';
    $port = '8889';
    $dbname = 'exemple';
    $username = 'root';
    $password = 'root';
    
    $dsn = "mysql:host=$host;port=$port;dbname=$dbname;charset=utf8mb4";
    $pdo = new PDO($dsn, $username, $password, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
    ]);
    
    // VÃ©rifier la structure de la table users
    $stmt = $pdo->prepare("DESCRIBE users");
    $stmt->execute();
    $columns = $stmt->fetchAll();
    
    echo "ðŸ“‹ Colonnes de la table 'users' :\n";
    foreach ($columns as $column) {
        echo "  - " . $column['Field'] . " (" . $column['Type'] . ")" . 
             ($column['Null'] === 'YES' ? ' - NULL autorisÃ©' : ' - NOT NULL') . 
             ($column['Key'] ? ' - ' . $column['Key'] : '') . "\n";
    }
    
    // VÃ©rifier si la colonne notification_email existe
    $hasNotificationEmail = false;
    foreach ($columns as $column) {
        if ($column['Field'] === 'notification_email') {
            $hasNotificationEmail = true;
            break;
        }
    }
    
    echo "\nðŸ” Colonne 'notification_email' : " . ($hasNotificationEmail ? "âœ… Existe" : "âŒ N'existe pas") . "\n";
    
    if (!$hasNotificationEmail) {
        echo "\nðŸ’¡ La colonne 'notification_email' n'existe pas. CrÃ©ation...\n";
        
        $pdo->exec("ALTER TABLE users ADD COLUMN notification_email VARCHAR(255) NULL");
        echo "âœ… Colonne 'notification_email' crÃ©Ã©e avec succÃ¨s !\n";
    }
    
} catch (Exception $e) {
    echo "âŒ Erreur: " . $e->getMessage() . "\n";
}

echo "\nðŸ” VÃ©rification terminÃ©e !\n";
?>
